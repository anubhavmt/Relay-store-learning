{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/anubhavgupta/Documents/react_learning/graphql-react/relay-store-learning/node_modules/@babel/runtime/regenerator/index.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = persistedQueriesMiddleware;\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n/* eslint-disable no-console */\n\n\nfunction makePersistedQueryRequestWithFallback(_x) {\n  return _makePersistedQueryRequestWithFallback.apply(this, arguments);\n}\n\nfunction _makePersistedQueryRequestWithFallback() {\n  _makePersistedQueryRequestWithFallback = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(o) {\n    var original,\n        hasRunFallback,\n        makeFallback,\n        makeRequest,\n        _args3 = arguments;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            original = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : false;\n            hasRunFallback = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : false;\n\n            makeFallback = /*#__PURE__*/function () {\n              var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(prevError) {\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        if (!hasRunFallback) {\n                          _context.next = 2;\n                          break;\n                        }\n\n                        throw prevError;\n\n                      case 2:\n                        return _context.abrupt(\"return\", makePersistedQueryRequestWithFallback(o, true, true));\n\n                      case 3:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function makeFallback(_x2) {\n                return _ref.apply(this, arguments);\n              };\n            }();\n\n            makeRequest = /*#__PURE__*/function () {\n              var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                var _o$options, persistedQueriesReq, _persistedQueriesReq$, cacheID, id, queryText, queryId, body;\n\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        _context2.prev = 0; // We make a new duplicate request and see if the backend is able to\n                        // process it\n                        // If the backend rejects it we fallback to the original request (which has the text query)\n\n                        persistedQueriesReq = JSON.parse(JSON.stringify(o.req));\n                        _persistedQueriesReq$ = persistedQueriesReq.operation, cacheID = _persistedQueriesReq$.cacheID, id = _persistedQueriesReq$.id, queryText = _persistedQueriesReq$.text;\n                        queryId = id || cacheID;\n\n                        if (!(!queryId && (!((_o$options = o.options) !== null && _o$options !== void 0 && _o$options.hash) || !queryText))) {\n                          _context2.next = 6;\n                          break;\n                        }\n\n                        throw new Error('Either query id or hashing function & query must be defined!');\n\n                      case 6:\n                        // Add doc_id to the request and remove the query text\n                        body = JSON.parse(persistedQueriesReq.fetchOpts.body);\n                        delete body.query;\n                        body.doc_id = queryId;\n                        persistedQueriesReq.fetchOpts.body = JSON.stringify(body);\n                        delete persistedQueriesReq.operation.text;\n                        _context2.next = 13;\n                        return o.next(original ? o.req : persistedQueriesReq);\n\n                      case 13:\n                        return _context2.abrupt(\"return\", _context2.sent);\n\n                      case 16:\n                        _context2.prev = 16;\n                        _context2.t0 = _context2[\"catch\"](0);\n                        return _context2.abrupt(\"return\", makeFallback(_context2.t0));\n\n                      case 19:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2, null, [[0, 16]]);\n              }));\n\n              return function makeRequest() {\n                return _ref2.apply(this, arguments);\n              };\n            }();\n\n            return _context3.abrupt(\"return\", makeRequest());\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _makePersistedQueryRequestWithFallback.apply(this, arguments);\n}\n\nfunction persistedQueriesMiddleware(options) {\n  return function (next) {\n    return function (req) {\n      return makePersistedQueryRequestWithFallback({\n        req: req,\n        next: next,\n        options: options\n      });\n    };\n  };\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","persistedQueriesMiddleware","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","makePersistedQueryRequestWithFallback","_x","_makePersistedQueryRequestWithFallback","mark","_callee3","o","original","hasRunFallback","makeFallback","makeRequest","_args3","wrap","_callee3$","_context3","prev","next","length","_ref","_callee","prevError","_callee$","_context","abrupt","stop","_x2","_ref2","_callee2","_o$options","persistedQueriesReq","_persistedQueriesReq$","cacheID","id","queryText","queryId","body","_callee2$","_context2","JSON","parse","stringify","req","operation","text","options","hash","Error","fetchOpts","query","doc_id","sent","t0"],"sources":["/Users/anubhavgupta/Documents/react_learning/graphql-react/relay-store-learning/node_modules/react-relay-network-modern/lib/middlewares/persistedQueries.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = persistedQueriesMiddleware;\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n/* eslint-disable no-console */\nfunction makePersistedQueryRequestWithFallback(_x) {\n  return _makePersistedQueryRequestWithFallback.apply(this, arguments);\n}\n\nfunction _makePersistedQueryRequestWithFallback() {\n  _makePersistedQueryRequestWithFallback = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(o) {\n    var original,\n        hasRunFallback,\n        makeFallback,\n        makeRequest,\n        _args3 = arguments;\n    return regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            original = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : false;\n            hasRunFallback = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : false;\n\n            makeFallback = /*#__PURE__*/function () {\n              var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(prevError) {\n                return regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        if (!hasRunFallback) {\n                          _context.next = 2;\n                          break;\n                        }\n\n                        throw prevError;\n\n                      case 2:\n                        return _context.abrupt(\"return\", makePersistedQueryRequestWithFallback(o, true, true));\n\n                      case 3:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function makeFallback(_x2) {\n                return _ref.apply(this, arguments);\n              };\n            }();\n\n            makeRequest = /*#__PURE__*/function () {\n              var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n                var _o$options, persistedQueriesReq, _persistedQueriesReq$, cacheID, id, queryText, queryId, body;\n\n                return regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        _context2.prev = 0;\n                        // We make a new duplicate request and see if the backend is able to\n                        // process it\n                        // If the backend rejects it we fallback to the original request (which has the text query)\n                        persistedQueriesReq = JSON.parse(JSON.stringify(o.req));\n                        _persistedQueriesReq$ = persistedQueriesReq.operation, cacheID = _persistedQueriesReq$.cacheID, id = _persistedQueriesReq$.id, queryText = _persistedQueriesReq$.text;\n                        queryId = id || cacheID;\n\n                        if (!(!queryId && (!((_o$options = o.options) !== null && _o$options !== void 0 && _o$options.hash) || !queryText))) {\n                          _context2.next = 6;\n                          break;\n                        }\n\n                        throw new Error('Either query id or hashing function & query must be defined!');\n\n                      case 6:\n                        // Add doc_id to the request and remove the query text\n                        body = JSON.parse(persistedQueriesReq.fetchOpts.body);\n                        delete body.query;\n                        body.doc_id = queryId;\n                        persistedQueriesReq.fetchOpts.body = JSON.stringify(body);\n                        delete persistedQueriesReq.operation.text;\n                        _context2.next = 13;\n                        return o.next(original ? o.req : persistedQueriesReq);\n\n                      case 13:\n                        return _context2.abrupt(\"return\", _context2.sent);\n\n                      case 16:\n                        _context2.prev = 16;\n                        _context2.t0 = _context2[\"catch\"](0);\n                        return _context2.abrupt(\"return\", makeFallback(_context2.t0));\n\n                      case 19:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2, null, [[0, 16]]);\n              }));\n\n              return function makeRequest() {\n                return _ref2.apply(this, arguments);\n              };\n            }();\n\n            return _context3.abrupt(\"return\", makeRequest());\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _makePersistedQueryRequestWithFallback.apply(this, arguments);\n}\n\nfunction persistedQueriesMiddleware(options) {\n  return function (next) {\n    return function (req) {\n      return makePersistedQueryRequestWithFallback({\n        req: req,\n        next: next,\n        options: options\n      });\n    };\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"script"}