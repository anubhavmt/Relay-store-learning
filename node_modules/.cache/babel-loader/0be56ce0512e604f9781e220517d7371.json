{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/anubhavgupta/Documents/react_learning/graphql-react/relay-store-learning/node_modules/@babel/runtime/regenerator/index.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = uploadMiddleware;\n\nvar _extractFiles2 = require(\"extract-files\");\n\nvar _RelayRequestBatch = _interopRequireDefault(require(\"../RelayRequestBatch\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction uploadMiddleware() {\n  return function (next) {\n    return /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(req) {\n        var operations, _extractFiles, extractedOperations, files, formData, pathMap, i, res;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(req instanceof _RelayRequestBatch[\"default\"])) {\n                  _context.next = 2;\n                  break;\n                }\n\n                throw new Error('RelayRequestBatch is not supported');\n\n              case 2:\n                operations = {\n                  query: req.operation.text,\n                  variables: req.variables\n                };\n                _extractFiles = (0, _extractFiles2.extractFiles)(operations), extractedOperations = _extractFiles.clone, files = _extractFiles.files;\n\n                if (files.size) {\n                  formData = new FormData();\n                  formData.append('operations', JSON.stringify(extractedOperations));\n                  pathMap = {};\n                  i = 0;\n                  files.forEach(function (paths) {\n                    pathMap[++i] = paths;\n                  });\n                  formData.append('map', JSON.stringify(pathMap));\n                  i = 0;\n                  files.forEach(function (paths, file) {\n                    formData.append(++i, file, file.name);\n                  });\n                  req.fetchOpts.method = 'POST';\n                  req.fetchOpts.body = formData;\n                  delete req.fetchOpts.headers['Content-Type'];\n                }\n\n                _context.next = 7;\n                return next(req);\n\n              case 7:\n                res = _context.sent;\n                return _context.abrupt(\"return\", res);\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  };\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","uploadMiddleware","_extractFiles2","require","_RelayRequestBatch","_interopRequireDefault","obj","__esModule","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","next","_ref","mark","_callee","req","operations","_extractFiles","extractedOperations","files","formData","pathMap","i","res","wrap","_callee$","_context","prev","Error","query","operation","text","variables","extractFiles","clone","size","FormData","append","JSON","stringify","forEach","paths","file","name","fetchOpts","method","body","headers","sent","abrupt","stop","_x"],"sources":["/Users/anubhavgupta/Documents/react_learning/graphql-react/relay-store-learning/node_modules/react-relay-network-modern/lib/middlewares/upload.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = uploadMiddleware;\n\nvar _extractFiles2 = require(\"extract-files\");\n\nvar _RelayRequestBatch = _interopRequireDefault(require(\"../RelayRequestBatch\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction uploadMiddleware() {\n  return function (next) {\n    return /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(req) {\n        var operations, _extractFiles, extractedOperations, files, formData, pathMap, i, res;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(req instanceof _RelayRequestBatch[\"default\"])) {\n                  _context.next = 2;\n                  break;\n                }\n\n                throw new Error('RelayRequestBatch is not supported');\n\n              case 2:\n                operations = {\n                  query: req.operation.text,\n                  variables: req.variables\n                };\n                _extractFiles = (0, _extractFiles2.extractFiles)(operations), extractedOperations = _extractFiles.clone, files = _extractFiles.files;\n\n                if (files.size) {\n                  formData = new FormData();\n                  formData.append('operations', JSON.stringify(extractedOperations));\n                  pathMap = {};\n                  i = 0;\n                  files.forEach(function (paths) {\n                    pathMap[++i] = paths;\n                  });\n                  formData.append('map', JSON.stringify(pathMap));\n                  i = 0;\n                  files.forEach(function (paths, file) {\n                    formData.append(++i, file, file.name);\n                  });\n                  req.fetchOpts.method = 'POST';\n                  req.fetchOpts.body = formData;\n                  delete req.fetchOpts.headers['Content-Type'];\n                }\n\n                _context.next = 7;\n                return next(req);\n\n              case 7:\n                res = _context.sent;\n                return _context.abrupt(\"return\", res);\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"script"}