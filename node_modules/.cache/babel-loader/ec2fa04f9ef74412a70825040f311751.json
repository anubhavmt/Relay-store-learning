{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/anubhavgupta/Documents/react_learning/graphql-react/relay-store-learning/node_modules/@babel/runtime/regenerator/index.js\");\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RRNLBatchMiddlewareError = void 0;\nexports[\"default\"] = batchMiddleware;\n\nvar _utils = require(\"../utils\");\n\nvar _RelayRequestBatch = _interopRequireDefault(require(\"../RelayRequestBatch\"));\n\nvar _RelayRequest = _interopRequireDefault(require(\"../RelayRequest\"));\n\nvar _RRNLError2 = _interopRequireDefault(require(\"../RRNLError\"));\n\nvar _excluded = [\"headersOrThunk\"];\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n} // Max out at roughly 100kb (express-graphql imposed max)\n\n\nvar DEFAULT_BATCH_SIZE = 102400;\n\nvar RRNLBatchMiddlewareError = /*#__PURE__*/function (_RRNLError) {\n  _inherits(RRNLBatchMiddlewareError, _RRNLError);\n\n  var _super = _createSuper(RRNLBatchMiddlewareError);\n\n  function RRNLBatchMiddlewareError(msg) {\n    var _this;\n\n    _classCallCheck(this, RRNLBatchMiddlewareError);\n\n    _this = _super.call(this, msg);\n    _this.name = 'RRNLBatchMiddlewareError';\n    return _this;\n  }\n\n  return RRNLBatchMiddlewareError;\n}(_RRNLError2[\"default\"]);\n\nexports.RRNLBatchMiddlewareError = RRNLBatchMiddlewareError;\n\nfunction batchMiddleware(options) {\n  var opts = options || {};\n  var batchTimeout = opts.batchTimeout || 0; // 0 is the same as nextTick in nodeJS\n\n  var allowMutations = opts.allowMutations || false;\n  var batchUrl = opts.batchUrl || '/graphql/batch';\n  var maxBatchSize = opts.maxBatchSize || DEFAULT_BATCH_SIZE;\n  var singleton = {};\n  var fetchOpts = {};\n  if (opts.method) fetchOpts.method = opts.method;\n  if (opts.credentials) fetchOpts.credentials = opts.credentials;\n  if (opts.mode) fetchOpts.mode = opts.mode;\n  if (opts.cache) fetchOpts.cache = opts.cache;\n  if (opts.redirect) fetchOpts.redirect = opts.redirect;\n  if (opts.headers) fetchOpts.headersOrThunk = opts.headers;\n  return function (next) {\n    return function (req) {\n      // do not batch mutations unless allowMutations = true\n      if (req.isMutation() && !allowMutations) {\n        return next(req);\n      }\n\n      if (!(req instanceof _RelayRequest[\"default\"])) {\n        throw new RRNLBatchMiddlewareError('Relay batch middleware accepts only simple RelayRequest. Did you add batchMiddleware twice?');\n      } // req with FormData can not be batched\n\n\n      if (req.isFormData()) {\n        return next(req);\n      } // skip batching if request explicitly opts out\n\n\n      if (req.cacheConfig.skipBatch) {\n        return next(req);\n      }\n\n      return passThroughBatch(req, next, {\n        batchTimeout: batchTimeout,\n        batchUrl: batchUrl,\n        singleton: singleton,\n        maxBatchSize: maxBatchSize,\n        fetchOpts: fetchOpts\n      });\n    };\n  };\n}\n\nfunction passThroughBatch(req, next, opts) {\n  var singleton = opts.singleton;\n  var bodyLength = req.getBody().length;\n\n  if (!bodyLength) {\n    return next(req);\n  }\n\n  if (!singleton.batcher || !singleton.batcher.acceptRequests) {\n    singleton.batcher = prepareNewBatcher(next, opts);\n  }\n\n  if (singleton.batcher.bodySize + bodyLength + 1 > opts.maxBatchSize) {\n    singleton.batcher = prepareNewBatcher(next, opts);\n  } // +1 accounts for tailing comma after joining\n\n\n  singleton.batcher.bodySize += bodyLength + 1; // queue request\n\n  return new Promise(function (resolve, reject) {\n    var requestList = singleton.batcher.requestList;\n    var requestWrapper = {\n      req: req,\n      completeOk: function completeOk(res) {\n        requestWrapper.done = true;\n        resolve(res);\n        requestWrapper.duplicates.forEach(function (r) {\n          return r.completeOk(res);\n        });\n      },\n      completeErr: function completeErr(err) {\n        requestWrapper.done = true;\n        reject(err);\n        requestWrapper.duplicates.forEach(function (r) {\n          return r.completeErr(err);\n        });\n      },\n      done: false,\n      duplicates: []\n    };\n    var duplicateIndex = requestList.findIndex(function (wrapper) {\n      return req.getBody() === wrapper.req.getBody();\n    });\n\n    if (duplicateIndex !== -1) {\n      /*\n        I've run into a scenario with Relay Classic where if you have 2 components\n        that make the exact same query, Relay will dedup the queries and reuse\n        the request ids but still make 2 requests. The batch code then loses track\n        of all the duplicate requests being made and never resolves or rejects\n        the duplicate requests\n        https://github.com/nodkz/react-relay-network-layer/pull/52\n      */\n      requestList[duplicateIndex].duplicates.push(requestWrapper);\n    } else {\n      requestList.push(requestWrapper);\n    }\n  });\n}\n\nfunction prepareNewBatcher(next, opts) {\n  var batcher = {\n    bodySize: 2,\n    // account for '[]'\n    requestList: [],\n    acceptRequests: true\n  };\n  setTimeout(function () {\n    batcher.acceptRequests = false;\n    sendRequests(batcher.requestList, next, opts).then(function () {\n      return finalizeUncompleted(batcher.requestList);\n    })[\"catch\"](function (e) {\n      if (e && e.name === 'AbortError') {\n        finalizeCanceled(batcher.requestList, e);\n      } else {\n        finalizeUncompleted(batcher.requestList);\n      }\n    });\n  }, opts.batchTimeout);\n  return batcher;\n}\n\nfunction sendRequests(_x, _x2, _x3) {\n  return _sendRequests.apply(this, arguments);\n} // check that server returns responses for all requests\n\n\nfunction _sendRequests() {\n  _sendRequests = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(requestList, next, opts) {\n    var wrapper, _res, batchRequest, url, _opts$fetchOpts, headersOrThunk, fetchOpts, headers, batchResponse;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!(requestList.length === 1)) {\n              _context.next = 10;\n              break;\n            } // SEND AS SINGLE QUERY\n\n\n            wrapper = requestList[0];\n            _context.next = 4;\n            return next(wrapper.req);\n\n          case 4:\n            _res = _context.sent;\n            wrapper.completeOk(_res);\n            wrapper.duplicates.forEach(function (r) {\n              return r.completeOk(_res);\n            });\n            return _context.abrupt(\"return\", _res);\n\n          case 10:\n            if (!(requestList.length > 1)) {\n              _context.next = 36;\n              break;\n            } // SEND AS BATCHED QUERY\n\n\n            batchRequest = new _RelayRequestBatch[\"default\"](requestList.map(function (wrapper) {\n              return wrapper.req;\n            })); // $FlowFixMe\n\n            _context.next = 14;\n            return (0, _utils.isFunction)(opts.batchUrl) ? opts.batchUrl(requestList) : opts.batchUrl;\n\n          case 14:\n            url = _context.sent;\n            batchRequest.setFetchOption('url', url);\n            _opts$fetchOpts = opts.fetchOpts, headersOrThunk = _opts$fetchOpts.headersOrThunk, fetchOpts = _objectWithoutProperties(_opts$fetchOpts, _excluded);\n            batchRequest.setFetchOptions(fetchOpts);\n\n            if (!headersOrThunk) {\n              _context.next = 23;\n              break;\n            }\n\n            _context.next = 21;\n            return (0, _utils.isFunction)(headersOrThunk) ? headersOrThunk(batchRequest) : headersOrThunk;\n\n          case 21:\n            headers = _context.sent;\n            batchRequest.setFetchOption('headers', headers);\n\n          case 23:\n            _context.prev = 23;\n            _context.next = 26;\n            return next(batchRequest);\n\n          case 26:\n            batchResponse = _context.sent;\n\n            if (!(!batchResponse || !Array.isArray(batchResponse.json))) {\n              _context.next = 29;\n              break;\n            }\n\n            throw new RRNLBatchMiddlewareError('Wrong response from server. Did your server support batch request?');\n\n          case 29:\n            batchResponse.json.forEach(function (payload, index) {\n              if (!payload) return;\n              var request = requestList[index];\n\n              if (request) {\n                var _res2 = createSingleResponse(batchResponse, payload);\n\n                request.completeOk(_res2);\n              }\n            });\n            return _context.abrupt(\"return\", batchResponse);\n\n          case 33:\n            _context.prev = 33;\n            _context.t0 = _context[\"catch\"](23);\n            requestList.forEach(function (request) {\n              return request.completeErr(_context.t0);\n            });\n\n          case 36:\n            return _context.abrupt(\"return\", Promise.resolve());\n\n          case 37:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[23, 33]]);\n  }));\n  return _sendRequests.apply(this, arguments);\n}\n\nfunction finalizeCanceled(requestList, error) {\n  requestList.forEach(function (request) {\n    return request.completeErr(error);\n  });\n} // check that server returns responses for all requests\n\n\nfunction finalizeUncompleted(requestList) {\n  requestList.forEach(function (request, index) {\n    if (!request.done) {\n      request.completeErr(new RRNLBatchMiddlewareError(\"Server does not return response for request at index \".concat(index, \".\\n\") + \"Response should have an array with \".concat(requestList.length, \" item(s).\")));\n    }\n  });\n}\n\nfunction createSingleResponse(batchResponse, json) {\n  // Fallback for graphql-graphene and apollo-server batch responses\n  var data = json.payload || json;\n  var res = batchResponse.clone();\n  res.processJsonData(data);\n  return res;\n}","map":{"version":3,"names":["_typeof","obj","Symbol","iterator","constructor","prototype","Object","defineProperty","exports","value","RRNLBatchMiddlewareError","batchMiddleware","_utils","require","_RelayRequestBatch","_interopRequireDefault","_RelayRequest","_RRNLError2","_excluded","__esModule","_objectWithoutProperties","source","excluded","target","_objectWithoutPropertiesLoose","key","i","getOwnPropertySymbols","sourceSymbolKeys","length","indexOf","propertyIsEnumerable","call","sourceKeys","keys","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_classCallCheck","instance","Constructor","TypeError","_inherits","subClass","superClass","create","writable","configurable","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","_possibleConstructorReturn","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","DEFAULT_BATCH_SIZE","_RRNLError","_super","msg","_this","name","options","opts","batchTimeout","allowMutations","batchUrl","maxBatchSize","singleton","fetchOpts","method","credentials","mode","cache","redirect","headers","headersOrThunk","next","req","isMutation","isFormData","cacheConfig","skipBatch","passThroughBatch","bodyLength","getBody","batcher","acceptRequests","prepareNewBatcher","bodySize","requestList","requestWrapper","completeOk","res","duplicates","forEach","r","completeErr","duplicateIndex","findIndex","wrapper","push","setTimeout","sendRequests","finalizeUncompleted","finalizeCanceled","_x","_x2","_x3","_sendRequests","mark","_callee","_res","batchRequest","url","_opts$fetchOpts","batchResponse","wrap","_callee$","_context","prev","sent","abrupt","map","isFunction","setFetchOption","setFetchOptions","Array","isArray","json","payload","index","request","_res2","createSingleResponse","t0","stop","concat","data","clone","processJsonData"],"sources":["/Users/anubhavgupta/Documents/react_learning/graphql-react/relay-store-learning/node_modules/react-relay-network-modern/lib/middlewares/batch.js"],"sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RRNLBatchMiddlewareError = void 0;\nexports[\"default\"] = batchMiddleware;\n\nvar _utils = require(\"../utils\");\n\nvar _RelayRequestBatch = _interopRequireDefault(require(\"../RelayRequestBatch\"));\n\nvar _RelayRequest = _interopRequireDefault(require(\"../RelayRequest\"));\n\nvar _RRNLError2 = _interopRequireDefault(require(\"../RRNLError\"));\n\nvar _excluded = [\"headersOrThunk\"];\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n// Max out at roughly 100kb (express-graphql imposed max)\nvar DEFAULT_BATCH_SIZE = 102400;\n\nvar RRNLBatchMiddlewareError = /*#__PURE__*/function (_RRNLError) {\n  _inherits(RRNLBatchMiddlewareError, _RRNLError);\n\n  var _super = _createSuper(RRNLBatchMiddlewareError);\n\n  function RRNLBatchMiddlewareError(msg) {\n    var _this;\n\n    _classCallCheck(this, RRNLBatchMiddlewareError);\n\n    _this = _super.call(this, msg);\n    _this.name = 'RRNLBatchMiddlewareError';\n    return _this;\n  }\n\n  return RRNLBatchMiddlewareError;\n}(_RRNLError2[\"default\"]);\n\nexports.RRNLBatchMiddlewareError = RRNLBatchMiddlewareError;\n\nfunction batchMiddleware(options) {\n  var opts = options || {};\n  var batchTimeout = opts.batchTimeout || 0; // 0 is the same as nextTick in nodeJS\n\n  var allowMutations = opts.allowMutations || false;\n  var batchUrl = opts.batchUrl || '/graphql/batch';\n  var maxBatchSize = opts.maxBatchSize || DEFAULT_BATCH_SIZE;\n  var singleton = {};\n  var fetchOpts = {};\n  if (opts.method) fetchOpts.method = opts.method;\n  if (opts.credentials) fetchOpts.credentials = opts.credentials;\n  if (opts.mode) fetchOpts.mode = opts.mode;\n  if (opts.cache) fetchOpts.cache = opts.cache;\n  if (opts.redirect) fetchOpts.redirect = opts.redirect;\n  if (opts.headers) fetchOpts.headersOrThunk = opts.headers;\n  return function (next) {\n    return function (req) {\n      // do not batch mutations unless allowMutations = true\n      if (req.isMutation() && !allowMutations) {\n        return next(req);\n      }\n\n      if (!(req instanceof _RelayRequest[\"default\"])) {\n        throw new RRNLBatchMiddlewareError('Relay batch middleware accepts only simple RelayRequest. Did you add batchMiddleware twice?');\n      } // req with FormData can not be batched\n\n\n      if (req.isFormData()) {\n        return next(req);\n      } // skip batching if request explicitly opts out\n\n\n      if (req.cacheConfig.skipBatch) {\n        return next(req);\n      }\n\n      return passThroughBatch(req, next, {\n        batchTimeout: batchTimeout,\n        batchUrl: batchUrl,\n        singleton: singleton,\n        maxBatchSize: maxBatchSize,\n        fetchOpts: fetchOpts\n      });\n    };\n  };\n}\n\nfunction passThroughBatch(req, next, opts) {\n  var singleton = opts.singleton;\n  var bodyLength = req.getBody().length;\n\n  if (!bodyLength) {\n    return next(req);\n  }\n\n  if (!singleton.batcher || !singleton.batcher.acceptRequests) {\n    singleton.batcher = prepareNewBatcher(next, opts);\n  }\n\n  if (singleton.batcher.bodySize + bodyLength + 1 > opts.maxBatchSize) {\n    singleton.batcher = prepareNewBatcher(next, opts);\n  } // +1 accounts for tailing comma after joining\n\n\n  singleton.batcher.bodySize += bodyLength + 1; // queue request\n\n  return new Promise(function (resolve, reject) {\n    var requestList = singleton.batcher.requestList;\n    var requestWrapper = {\n      req: req,\n      completeOk: function completeOk(res) {\n        requestWrapper.done = true;\n        resolve(res);\n        requestWrapper.duplicates.forEach(function (r) {\n          return r.completeOk(res);\n        });\n      },\n      completeErr: function completeErr(err) {\n        requestWrapper.done = true;\n        reject(err);\n        requestWrapper.duplicates.forEach(function (r) {\n          return r.completeErr(err);\n        });\n      },\n      done: false,\n      duplicates: []\n    };\n    var duplicateIndex = requestList.findIndex(function (wrapper) {\n      return req.getBody() === wrapper.req.getBody();\n    });\n\n    if (duplicateIndex !== -1) {\n      /*\n        I've run into a scenario with Relay Classic where if you have 2 components\n        that make the exact same query, Relay will dedup the queries and reuse\n        the request ids but still make 2 requests. The batch code then loses track\n        of all the duplicate requests being made and never resolves or rejects\n        the duplicate requests\n        https://github.com/nodkz/react-relay-network-layer/pull/52\n      */\n      requestList[duplicateIndex].duplicates.push(requestWrapper);\n    } else {\n      requestList.push(requestWrapper);\n    }\n  });\n}\n\nfunction prepareNewBatcher(next, opts) {\n  var batcher = {\n    bodySize: 2,\n    // account for '[]'\n    requestList: [],\n    acceptRequests: true\n  };\n  setTimeout(function () {\n    batcher.acceptRequests = false;\n    sendRequests(batcher.requestList, next, opts).then(function () {\n      return finalizeUncompleted(batcher.requestList);\n    })[\"catch\"](function (e) {\n      if (e && e.name === 'AbortError') {\n        finalizeCanceled(batcher.requestList, e);\n      } else {\n        finalizeUncompleted(batcher.requestList);\n      }\n    });\n  }, opts.batchTimeout);\n  return batcher;\n}\n\nfunction sendRequests(_x, _x2, _x3) {\n  return _sendRequests.apply(this, arguments);\n} // check that server returns responses for all requests\n\n\nfunction _sendRequests() {\n  _sendRequests = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(requestList, next, opts) {\n    var wrapper, _res, batchRequest, url, _opts$fetchOpts, headersOrThunk, fetchOpts, headers, batchResponse;\n\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!(requestList.length === 1)) {\n              _context.next = 10;\n              break;\n            }\n\n            // SEND AS SINGLE QUERY\n            wrapper = requestList[0];\n            _context.next = 4;\n            return next(wrapper.req);\n\n          case 4:\n            _res = _context.sent;\n            wrapper.completeOk(_res);\n            wrapper.duplicates.forEach(function (r) {\n              return r.completeOk(_res);\n            });\n            return _context.abrupt(\"return\", _res);\n\n          case 10:\n            if (!(requestList.length > 1)) {\n              _context.next = 36;\n              break;\n            }\n\n            // SEND AS BATCHED QUERY\n            batchRequest = new _RelayRequestBatch[\"default\"](requestList.map(function (wrapper) {\n              return wrapper.req;\n            })); // $FlowFixMe\n\n            _context.next = 14;\n            return (0, _utils.isFunction)(opts.batchUrl) ? opts.batchUrl(requestList) : opts.batchUrl;\n\n          case 14:\n            url = _context.sent;\n            batchRequest.setFetchOption('url', url);\n            _opts$fetchOpts = opts.fetchOpts, headersOrThunk = _opts$fetchOpts.headersOrThunk, fetchOpts = _objectWithoutProperties(_opts$fetchOpts, _excluded);\n            batchRequest.setFetchOptions(fetchOpts);\n\n            if (!headersOrThunk) {\n              _context.next = 23;\n              break;\n            }\n\n            _context.next = 21;\n            return (0, _utils.isFunction)(headersOrThunk) ? headersOrThunk(batchRequest) : headersOrThunk;\n\n          case 21:\n            headers = _context.sent;\n            batchRequest.setFetchOption('headers', headers);\n\n          case 23:\n            _context.prev = 23;\n            _context.next = 26;\n            return next(batchRequest);\n\n          case 26:\n            batchResponse = _context.sent;\n\n            if (!(!batchResponse || !Array.isArray(batchResponse.json))) {\n              _context.next = 29;\n              break;\n            }\n\n            throw new RRNLBatchMiddlewareError('Wrong response from server. Did your server support batch request?');\n\n          case 29:\n            batchResponse.json.forEach(function (payload, index) {\n              if (!payload) return;\n              var request = requestList[index];\n\n              if (request) {\n                var _res2 = createSingleResponse(batchResponse, payload);\n\n                request.completeOk(_res2);\n              }\n            });\n            return _context.abrupt(\"return\", batchResponse);\n\n          case 33:\n            _context.prev = 33;\n            _context.t0 = _context[\"catch\"](23);\n            requestList.forEach(function (request) {\n              return request.completeErr(_context.t0);\n            });\n\n          case 36:\n            return _context.abrupt(\"return\", Promise.resolve());\n\n          case 37:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[23, 33]]);\n  }));\n  return _sendRequests.apply(this, arguments);\n}\n\nfunction finalizeCanceled(requestList, error) {\n  requestList.forEach(function (request) {\n    return request.completeErr(error);\n  });\n} // check that server returns responses for all requests\n\n\nfunction finalizeUncompleted(requestList) {\n  requestList.forEach(function (request, index) {\n    if (!request.done) {\n      request.completeErr(new RRNLBatchMiddlewareError(\"Server does not return response for request at index \".concat(index, \".\\n\") + \"Response should have an array with \".concat(requestList.length, \" item(s).\")));\n    }\n  });\n}\n\nfunction createSingleResponse(batchResponse, json) {\n  // Fallback for graphql-graphene and apollo-server batch responses\n  var data = json.payload || json;\n  var res = batchResponse.clone();\n  res.processJsonData(data);\n  return res;\n}"],"mappings":"AAAA;;;;AAEA,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;EAAE;;EAA2B,IAAI,OAAOC,MAAP,KAAkB,UAAlB,IAAgC,OAAOA,MAAM,CAACC,QAAd,KAA2B,QAA/D,EAAyE;IAAEH,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;MAAE,OAAO,OAAOA,GAAd;IAAoB,CAAtD;EAAyD,CAApI,MAA0I;IAAED,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;MAAE,OAAOA,GAAG,IAAI,OAAOC,MAAP,KAAkB,UAAzB,IAAuCD,GAAG,CAACG,WAAJ,KAAoBF,MAA3D,IAAqED,GAAG,KAAKC,MAAM,CAACG,SAApF,GAAgG,QAAhG,GAA2G,OAAOJ,GAAzH;IAA+H,CAAjK;EAAoK;;EAAC,OAAOD,OAAO,CAACC,GAAD,CAAd;AAAsB;;AAE1XK,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAC3CC,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,wBAAR,GAAmC,KAAK,CAAxC;AACAF,OAAO,CAAC,SAAD,CAAP,GAAqBG,eAArB;;AAEA,IAAIC,MAAM,GAAGC,OAAO,CAAC,UAAD,CAApB;;AAEA,IAAIC,kBAAkB,GAAGC,sBAAsB,CAACF,OAAO,CAAC,sBAAD,CAAR,CAA/C;;AAEA,IAAIG,aAAa,GAAGD,sBAAsB,CAACF,OAAO,CAAC,iBAAD,CAAR,CAA1C;;AAEA,IAAII,WAAW,GAAGF,sBAAsB,CAACF,OAAO,CAAC,cAAD,CAAR,CAAxC;;AAEA,IAAIK,SAAS,GAAG,CAAC,gBAAD,CAAhB;;AAEA,SAASH,sBAAT,CAAgCd,GAAhC,EAAqC;EAAE,OAAOA,GAAG,IAAIA,GAAG,CAACkB,UAAX,GAAwBlB,GAAxB,GAA8B;IAAE,WAAWA;EAAb,CAArC;AAA0D;;AAEjG,SAASmB,wBAAT,CAAkCC,MAAlC,EAA0CC,QAA1C,EAAoD;EAAE,IAAID,MAAM,IAAI,IAAd,EAAoB,OAAO,EAAP;;EAAW,IAAIE,MAAM,GAAGC,6BAA6B,CAACH,MAAD,EAASC,QAAT,CAA1C;;EAA8D,IAAIG,GAAJ,EAASC,CAAT;;EAAY,IAAIpB,MAAM,CAACqB,qBAAX,EAAkC;IAAE,IAAIC,gBAAgB,GAAGtB,MAAM,CAACqB,qBAAP,CAA6BN,MAA7B,CAAvB;;IAA6D,KAAKK,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGE,gBAAgB,CAACC,MAAjC,EAAyCH,CAAC,EAA1C,EAA8C;MAAED,GAAG,GAAGG,gBAAgB,CAACF,CAAD,CAAtB;MAA2B,IAAIJ,QAAQ,CAACQ,OAAT,CAAiBL,GAAjB,KAAyB,CAA7B,EAAgC;MAAU,IAAI,CAACnB,MAAM,CAACD,SAAP,CAAiB0B,oBAAjB,CAAsCC,IAAtC,CAA2CX,MAA3C,EAAmDI,GAAnD,CAAL,EAA8D;MAAUF,MAAM,CAACE,GAAD,CAAN,GAAcJ,MAAM,CAACI,GAAD,CAApB;IAA4B;EAAE;;EAAC,OAAOF,MAAP;AAAgB;;AAE5e,SAASC,6BAAT,CAAuCH,MAAvC,EAA+CC,QAA/C,EAAyD;EAAE,IAAID,MAAM,IAAI,IAAd,EAAoB,OAAO,EAAP;EAAW,IAAIE,MAAM,GAAG,EAAb;EAAiB,IAAIU,UAAU,GAAG3B,MAAM,CAAC4B,IAAP,CAAYb,MAAZ,CAAjB;EAAsC,IAAII,GAAJ,EAASC,CAAT;;EAAY,KAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGO,UAAU,CAACJ,MAA3B,EAAmCH,CAAC,EAApC,EAAwC;IAAED,GAAG,GAAGQ,UAAU,CAACP,CAAD,CAAhB;IAAqB,IAAIJ,QAAQ,CAACQ,OAAT,CAAiBL,GAAjB,KAAyB,CAA7B,EAAgC;IAAUF,MAAM,CAACE,GAAD,CAAN,GAAcJ,MAAM,CAACI,GAAD,CAApB;EAA4B;;EAAC,OAAOF,MAAP;AAAgB;;AAEnT,SAASY,kBAAT,CAA4BC,GAA5B,EAAiCC,OAAjC,EAA0CC,MAA1C,EAAkDC,KAAlD,EAAyDC,MAAzD,EAAiEf,GAAjE,EAAsEgB,GAAtE,EAA2E;EAAE,IAAI;IAAE,IAAIC,IAAI,GAAGN,GAAG,CAACX,GAAD,CAAH,CAASgB,GAAT,CAAX;IAA0B,IAAIhC,KAAK,GAAGiC,IAAI,CAACjC,KAAjB;EAAyB,CAAzD,CAA0D,OAAOkC,KAAP,EAAc;IAAEL,MAAM,CAACK,KAAD,CAAN;IAAe;EAAS;;EAAC,IAAID,IAAI,CAACE,IAAT,EAAe;IAAEP,OAAO,CAAC5B,KAAD,CAAP;EAAiB,CAAlC,MAAwC;IAAEoC,OAAO,CAACR,OAAR,CAAgB5B,KAAhB,EAAuBqC,IAAvB,CAA4BP,KAA5B,EAAmCC,MAAnC;EAA6C;AAAE;;AAEzQ,SAASO,iBAAT,CAA2BC,EAA3B,EAA+B;EAAE,OAAO,YAAY;IAAE,IAAIC,IAAI,GAAG,IAAX;IAAA,IAAiBC,IAAI,GAAGC,SAAxB;IAAmC,OAAO,IAAIN,OAAJ,CAAY,UAAUR,OAAV,EAAmBC,MAAnB,EAA2B;MAAE,IAAIF,GAAG,GAAGY,EAAE,CAACI,KAAH,CAASH,IAAT,EAAeC,IAAf,CAAV;;MAAgC,SAASX,KAAT,CAAe9B,KAAf,EAAsB;QAAE0B,kBAAkB,CAACC,GAAD,EAAMC,OAAN,EAAeC,MAAf,EAAuBC,KAAvB,EAA8BC,MAA9B,EAAsC,MAAtC,EAA8C/B,KAA9C,CAAlB;MAAyE;;MAAC,SAAS+B,MAAT,CAAgBa,GAAhB,EAAqB;QAAElB,kBAAkB,CAACC,GAAD,EAAMC,OAAN,EAAeC,MAAf,EAAuBC,KAAvB,EAA8BC,MAA9B,EAAsC,OAAtC,EAA+Ca,GAA/C,CAAlB;MAAwE;;MAACd,KAAK,CAACe,SAAD,CAAL;IAAmB,CAA9R,CAAP;EAAyS,CAAjW;AAAoW;;AAErY,SAASC,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;EAAE,IAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;IAAE,MAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;EAA2D;AAAE;;AAEzJ,SAASC,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;EAAE,IAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,UAAU,KAAK,IAAvD,EAA6D;IAAE,MAAM,IAAIH,SAAJ,CAAc,oDAAd,CAAN;EAA4E;;EAACE,QAAQ,CAACvD,SAAT,GAAqBC,MAAM,CAACwD,MAAP,CAAcD,UAAU,IAAIA,UAAU,CAACxD,SAAvC,EAAkD;IAAED,WAAW,EAAE;MAAEK,KAAK,EAAEmD,QAAT;MAAmBG,QAAQ,EAAE,IAA7B;MAAmCC,YAAY,EAAE;IAAjD;EAAf,CAAlD,CAArB;EAAkJ,IAAIH,UAAJ,EAAgBI,eAAe,CAACL,QAAD,EAAWC,UAAX,CAAf;AAAwC;;AAEjY,SAASI,eAAT,CAAyBC,CAAzB,EAA4BC,CAA5B,EAA+B;EAAEF,eAAe,GAAG3D,MAAM,CAAC8D,cAAP,IAAyB,SAASH,eAAT,CAAyBC,CAAzB,EAA4BC,CAA5B,EAA+B;IAAED,CAAC,CAACG,SAAF,GAAcF,CAAd;IAAiB,OAAOD,CAAP;EAAW,CAAxG;;EAA0G,OAAOD,eAAe,CAACC,CAAD,EAAIC,CAAJ,CAAtB;AAA+B;;AAE1K,SAASG,YAAT,CAAsBC,OAAtB,EAA+B;EAAE,IAAIC,yBAAyB,GAAGC,yBAAyB,EAAzD;;EAA6D,OAAO,SAASC,oBAAT,GAAgC;IAAE,IAAIC,KAAK,GAAGC,eAAe,CAACL,OAAD,CAA3B;IAAA,IAAsCM,MAAtC;;IAA8C,IAAIL,yBAAJ,EAA+B;MAAE,IAAIM,SAAS,GAAGF,eAAe,CAAC,IAAD,CAAf,CAAsBxE,WAAtC;;MAAmDyE,MAAM,GAAGE,OAAO,CAACC,SAAR,CAAkBL,KAAlB,EAAyBxB,SAAzB,EAAoC2B,SAApC,CAAT;IAA0D,CAA9I,MAAoJ;MAAED,MAAM,GAAGF,KAAK,CAACvB,KAAN,CAAY,IAAZ,EAAkBD,SAAlB,CAAT;IAAwC;;IAAC,OAAO8B,0BAA0B,CAAC,IAAD,EAAOJ,MAAP,CAAjC;EAAkD,CAAxU;AAA2U;;AAEza,SAASI,0BAAT,CAAoChC,IAApC,EAA0CjB,IAA1C,EAAgD;EAAE,IAAIA,IAAI,KAAKhC,OAAO,CAACgC,IAAD,CAAP,KAAkB,QAAlB,IAA8B,OAAOA,IAAP,KAAgB,UAAnD,CAAR,EAAwE;IAAE,OAAOA,IAAP;EAAc,CAAxF,MAA8F,IAAIA,IAAI,KAAK,KAAK,CAAlB,EAAqB;IAAE,MAAM,IAAI0B,SAAJ,CAAc,0DAAd,CAAN;EAAkF;;EAAC,OAAOwB,sBAAsB,CAACjC,IAAD,CAA7B;AAAsC;;AAEhS,SAASiC,sBAAT,CAAgCjC,IAAhC,EAAsC;EAAE,IAAIA,IAAI,KAAK,KAAK,CAAlB,EAAqB;IAAE,MAAM,IAAIkC,cAAJ,CAAmB,2DAAnB,CAAN;EAAwF;;EAAC,OAAOlC,IAAP;AAAc;;AAEtK,SAASwB,yBAAT,GAAqC;EAAE,IAAI,OAAOM,OAAP,KAAmB,WAAnB,IAAkC,CAACA,OAAO,CAACC,SAA/C,EAA0D,OAAO,KAAP;EAAc,IAAID,OAAO,CAACC,SAAR,CAAkBI,IAAtB,EAA4B,OAAO,KAAP;EAAc,IAAI,OAAOC,KAAP,KAAiB,UAArB,EAAiC,OAAO,IAAP;;EAAa,IAAI;IAAEC,OAAO,CAACjF,SAAR,CAAkBkF,OAAlB,CAA0BvD,IAA1B,CAA+B+C,OAAO,CAACC,SAAR,CAAkBM,OAAlB,EAA2B,EAA3B,EAA+B,YAAY,CAAE,CAA7C,CAA/B;IAAgF,OAAO,IAAP;EAAc,CAApG,CAAqG,OAAOE,CAAP,EAAU;IAAE,OAAO,KAAP;EAAe;AAAE;;AAEzU,SAASZ,eAAT,CAAyBV,CAAzB,EAA4B;EAAEU,eAAe,GAAGtE,MAAM,CAAC8D,cAAP,GAAwB9D,MAAM,CAACmF,cAA/B,GAAgD,SAASb,eAAT,CAAyBV,CAAzB,EAA4B;IAAE,OAAOA,CAAC,CAACG,SAAF,IAAe/D,MAAM,CAACmF,cAAP,CAAsBvB,CAAtB,CAAtB;EAAiD,CAAjJ;EAAmJ,OAAOU,eAAe,CAACV,CAAD,CAAtB;AAA4B,C,CAE7M;;;AACA,IAAIwB,kBAAkB,GAAG,MAAzB;;AAEA,IAAIhF,wBAAwB,GAAG,aAAa,UAAUiF,UAAV,EAAsB;EAChEhC,SAAS,CAACjD,wBAAD,EAA2BiF,UAA3B,CAAT;;EAEA,IAAIC,MAAM,GAAGtB,YAAY,CAAC5D,wBAAD,CAAzB;;EAEA,SAASA,wBAAT,CAAkCmF,GAAlC,EAAuC;IACrC,IAAIC,KAAJ;;IAEAvC,eAAe,CAAC,IAAD,EAAO7C,wBAAP,CAAf;;IAEAoF,KAAK,GAAGF,MAAM,CAAC5D,IAAP,CAAY,IAAZ,EAAkB6D,GAAlB,CAAR;IACAC,KAAK,CAACC,IAAN,GAAa,0BAAb;IACA,OAAOD,KAAP;EACD;;EAED,OAAOpF,wBAAP;AACD,CAhB2C,CAgB1CO,WAAW,CAAC,SAAD,CAhB+B,CAA5C;;AAkBAT,OAAO,CAACE,wBAAR,GAAmCA,wBAAnC;;AAEA,SAASC,eAAT,CAAyBqF,OAAzB,EAAkC;EAChC,IAAIC,IAAI,GAAGD,OAAO,IAAI,EAAtB;EACA,IAAIE,YAAY,GAAGD,IAAI,CAACC,YAAL,IAAqB,CAAxC,CAFgC,CAEW;;EAE3C,IAAIC,cAAc,GAAGF,IAAI,CAACE,cAAL,IAAuB,KAA5C;EACA,IAAIC,QAAQ,GAAGH,IAAI,CAACG,QAAL,IAAiB,gBAAhC;EACA,IAAIC,YAAY,GAAGJ,IAAI,CAACI,YAAL,IAAqBX,kBAAxC;EACA,IAAIY,SAAS,GAAG,EAAhB;EACA,IAAIC,SAAS,GAAG,EAAhB;EACA,IAAIN,IAAI,CAACO,MAAT,EAAiBD,SAAS,CAACC,MAAV,GAAmBP,IAAI,CAACO,MAAxB;EACjB,IAAIP,IAAI,CAACQ,WAAT,EAAsBF,SAAS,CAACE,WAAV,GAAwBR,IAAI,CAACQ,WAA7B;EACtB,IAAIR,IAAI,CAACS,IAAT,EAAeH,SAAS,CAACG,IAAV,GAAiBT,IAAI,CAACS,IAAtB;EACf,IAAIT,IAAI,CAACU,KAAT,EAAgBJ,SAAS,CAACI,KAAV,GAAkBV,IAAI,CAACU,KAAvB;EAChB,IAAIV,IAAI,CAACW,QAAT,EAAmBL,SAAS,CAACK,QAAV,GAAqBX,IAAI,CAACW,QAA1B;EACnB,IAAIX,IAAI,CAACY,OAAT,EAAkBN,SAAS,CAACO,cAAV,GAA2Bb,IAAI,CAACY,OAAhC;EAClB,OAAO,UAAUE,IAAV,EAAgB;IACrB,OAAO,UAAUC,GAAV,EAAe;MACpB;MACA,IAAIA,GAAG,CAACC,UAAJ,MAAoB,CAACd,cAAzB,EAAyC;QACvC,OAAOY,IAAI,CAACC,GAAD,CAAX;MACD;;MAED,IAAI,EAAEA,GAAG,YAAYhG,aAAa,CAAC,SAAD,CAA9B,CAAJ,EAAgD;QAC9C,MAAM,IAAIN,wBAAJ,CAA6B,6FAA7B,CAAN;MACD,CARmB,CAQlB;;;MAGF,IAAIsG,GAAG,CAACE,UAAJ,EAAJ,EAAsB;QACpB,OAAOH,IAAI,CAACC,GAAD,CAAX;MACD,CAbmB,CAalB;;;MAGF,IAAIA,GAAG,CAACG,WAAJ,CAAgBC,SAApB,EAA+B;QAC7B,OAAOL,IAAI,CAACC,GAAD,CAAX;MACD;;MAED,OAAOK,gBAAgB,CAACL,GAAD,EAAMD,IAAN,EAAY;QACjCb,YAAY,EAAEA,YADmB;QAEjCE,QAAQ,EAAEA,QAFuB;QAGjCE,SAAS,EAAEA,SAHsB;QAIjCD,YAAY,EAAEA,YAJmB;QAKjCE,SAAS,EAAEA;MALsB,CAAZ,CAAvB;IAOD,CA3BD;EA4BD,CA7BD;AA8BD;;AAED,SAASc,gBAAT,CAA0BL,GAA1B,EAA+BD,IAA/B,EAAqCd,IAArC,EAA2C;EACzC,IAAIK,SAAS,GAAGL,IAAI,CAACK,SAArB;EACA,IAAIgB,UAAU,GAAGN,GAAG,CAACO,OAAJ,GAAc1F,MAA/B;;EAEA,IAAI,CAACyF,UAAL,EAAiB;IACf,OAAOP,IAAI,CAACC,GAAD,CAAX;EACD;;EAED,IAAI,CAACV,SAAS,CAACkB,OAAX,IAAsB,CAAClB,SAAS,CAACkB,OAAV,CAAkBC,cAA7C,EAA6D;IAC3DnB,SAAS,CAACkB,OAAV,GAAoBE,iBAAiB,CAACX,IAAD,EAAOd,IAAP,CAArC;EACD;;EAED,IAAIK,SAAS,CAACkB,OAAV,CAAkBG,QAAlB,GAA6BL,UAA7B,GAA0C,CAA1C,GAA8CrB,IAAI,CAACI,YAAvD,EAAqE;IACnEC,SAAS,CAACkB,OAAV,GAAoBE,iBAAiB,CAACX,IAAD,EAAOd,IAAP,CAArC;EACD,CAdwC,CAcvC;;;EAGFK,SAAS,CAACkB,OAAV,CAAkBG,QAAlB,IAA8BL,UAAU,GAAG,CAA3C,CAjByC,CAiBK;;EAE9C,OAAO,IAAIzE,OAAJ,CAAY,UAAUR,OAAV,EAAmBC,MAAnB,EAA2B;IAC5C,IAAIsF,WAAW,GAAGtB,SAAS,CAACkB,OAAV,CAAkBI,WAApC;IACA,IAAIC,cAAc,GAAG;MACnBb,GAAG,EAAEA,GADc;MAEnBc,UAAU,EAAE,SAASA,UAAT,CAAoBC,GAApB,EAAyB;QACnCF,cAAc,CAACjF,IAAf,GAAsB,IAAtB;QACAP,OAAO,CAAC0F,GAAD,CAAP;QACAF,cAAc,CAACG,UAAf,CAA0BC,OAA1B,CAAkC,UAAUC,CAAV,EAAa;UAC7C,OAAOA,CAAC,CAACJ,UAAF,CAAaC,GAAb,CAAP;QACD,CAFD;MAGD,CARkB;MASnBI,WAAW,EAAE,SAASA,WAAT,CAAqB9E,GAArB,EAA0B;QACrCwE,cAAc,CAACjF,IAAf,GAAsB,IAAtB;QACAN,MAAM,CAACe,GAAD,CAAN;QACAwE,cAAc,CAACG,UAAf,CAA0BC,OAA1B,CAAkC,UAAUC,CAAV,EAAa;UAC7C,OAAOA,CAAC,CAACC,WAAF,CAAc9E,GAAd,CAAP;QACD,CAFD;MAGD,CAfkB;MAgBnBT,IAAI,EAAE,KAhBa;MAiBnBoF,UAAU,EAAE;IAjBO,CAArB;IAmBA,IAAII,cAAc,GAAGR,WAAW,CAACS,SAAZ,CAAsB,UAAUC,OAAV,EAAmB;MAC5D,OAAOtB,GAAG,CAACO,OAAJ,OAAkBe,OAAO,CAACtB,GAAR,CAAYO,OAAZ,EAAzB;IACD,CAFoB,CAArB;;IAIA,IAAIa,cAAc,KAAK,CAAC,CAAxB,EAA2B;MACzB;AACN;AACA;AACA;AACA;AACA;AACA;AACA;MACMR,WAAW,CAACQ,cAAD,CAAX,CAA4BJ,UAA5B,CAAuCO,IAAvC,CAA4CV,cAA5C;IACD,CAVD,MAUO;MACLD,WAAW,CAACW,IAAZ,CAAiBV,cAAjB;IACD;EACF,CAtCM,CAAP;AAuCD;;AAED,SAASH,iBAAT,CAA2BX,IAA3B,EAAiCd,IAAjC,EAAuC;EACrC,IAAIuB,OAAO,GAAG;IACZG,QAAQ,EAAE,CADE;IAEZ;IACAC,WAAW,EAAE,EAHD;IAIZH,cAAc,EAAE;EAJJ,CAAd;EAMAe,UAAU,CAAC,YAAY;IACrBhB,OAAO,CAACC,cAAR,GAAyB,KAAzB;IACAgB,YAAY,CAACjB,OAAO,CAACI,WAAT,EAAsBb,IAAtB,EAA4Bd,IAA5B,CAAZ,CAA8CnD,IAA9C,CAAmD,YAAY;MAC7D,OAAO4F,mBAAmB,CAAClB,OAAO,CAACI,WAAT,CAA1B;IACD,CAFD,EAEG,OAFH,EAEY,UAAUpC,CAAV,EAAa;MACvB,IAAIA,CAAC,IAAIA,CAAC,CAACO,IAAF,KAAW,YAApB,EAAkC;QAChC4C,gBAAgB,CAACnB,OAAO,CAACI,WAAT,EAAsBpC,CAAtB,CAAhB;MACD,CAFD,MAEO;QACLkD,mBAAmB,CAAClB,OAAO,CAACI,WAAT,CAAnB;MACD;IACF,CARD;EASD,CAXS,EAWP3B,IAAI,CAACC,YAXE,CAAV;EAYA,OAAOsB,OAAP;AACD;;AAED,SAASiB,YAAT,CAAsBG,EAAtB,EAA0BC,GAA1B,EAA+BC,GAA/B,EAAoC;EAClC,OAAOC,aAAa,CAAC3F,KAAd,CAAoB,IAApB,EAA0BD,SAA1B,CAAP;AACD,C,CAAC;;;AAGF,SAAS4F,aAAT,GAAyB;EACvBA,aAAa,GAAGhG,iBAAiB,EAAE,aAAa,oBAAmBiG,IAAnB,CAAwB,SAASC,OAAT,CAAiBrB,WAAjB,EAA8Bb,IAA9B,EAAoCd,IAApC,EAA0C;IAChH,IAAIqC,OAAJ,EAAaY,IAAb,EAAmBC,YAAnB,EAAiCC,GAAjC,EAAsCC,eAAtC,EAAuDvC,cAAvD,EAAuEP,SAAvE,EAAkFM,OAAlF,EAA2FyC,aAA3F;;IAEA,OAAO,oBAAmBC,IAAnB,CAAwB,SAASC,QAAT,CAAkBC,QAAlB,EAA4B;MACzD,OAAO,CAAP,EAAU;QACR,QAAQA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAAC1C,IAAjC;UACE,KAAK,CAAL;YACE,IAAI,EAAEa,WAAW,CAAC/F,MAAZ,KAAuB,CAAzB,CAAJ,EAAiC;cAC/B4H,QAAQ,CAAC1C,IAAT,GAAgB,EAAhB;cACA;YACD,CAJH,CAME;;;YACAuB,OAAO,GAAGV,WAAW,CAAC,CAAD,CAArB;YACA6B,QAAQ,CAAC1C,IAAT,GAAgB,CAAhB;YACA,OAAOA,IAAI,CAACuB,OAAO,CAACtB,GAAT,CAAX;;UAEF,KAAK,CAAL;YACEkC,IAAI,GAAGO,QAAQ,CAACE,IAAhB;YACArB,OAAO,CAACR,UAAR,CAAmBoB,IAAnB;YACAZ,OAAO,CAACN,UAAR,CAAmBC,OAAnB,CAA2B,UAAUC,CAAV,EAAa;cACtC,OAAOA,CAAC,CAACJ,UAAF,CAAaoB,IAAb,CAAP;YACD,CAFD;YAGA,OAAOO,QAAQ,CAACG,MAAT,CAAgB,QAAhB,EAA0BV,IAA1B,CAAP;;UAEF,KAAK,EAAL;YACE,IAAI,EAAEtB,WAAW,CAAC/F,MAAZ,GAAqB,CAAvB,CAAJ,EAA+B;cAC7B4H,QAAQ,CAAC1C,IAAT,GAAgB,EAAhB;cACA;YACD,CAJH,CAME;;;YACAoC,YAAY,GAAG,IAAIrI,kBAAkB,CAAC,SAAD,CAAtB,CAAkC8G,WAAW,CAACiC,GAAZ,CAAgB,UAAUvB,OAAV,EAAmB;cAClF,OAAOA,OAAO,CAACtB,GAAf;YACD,CAFgD,CAAlC,CAAf,CAPF,CASO;;YAELyC,QAAQ,CAAC1C,IAAT,GAAgB,EAAhB;YACA,OAAO,CAAC,GAAGnG,MAAM,CAACkJ,UAAX,EAAuB7D,IAAI,CAACG,QAA5B,IAAwCH,IAAI,CAACG,QAAL,CAAcwB,WAAd,CAAxC,GAAqE3B,IAAI,CAACG,QAAjF;;UAEF,KAAK,EAAL;YACEgD,GAAG,GAAGK,QAAQ,CAACE,IAAf;YACAR,YAAY,CAACY,cAAb,CAA4B,KAA5B,EAAmCX,GAAnC;YACAC,eAAe,GAAGpD,IAAI,CAACM,SAAvB,EAAkCO,cAAc,GAAGuC,eAAe,CAACvC,cAAnE,EAAmFP,SAAS,GAAGnF,wBAAwB,CAACiI,eAAD,EAAkBnI,SAAlB,CAAvH;YACAiI,YAAY,CAACa,eAAb,CAA6BzD,SAA7B;;YAEA,IAAI,CAACO,cAAL,EAAqB;cACnB2C,QAAQ,CAAC1C,IAAT,GAAgB,EAAhB;cACA;YACD;;YAED0C,QAAQ,CAAC1C,IAAT,GAAgB,EAAhB;YACA,OAAO,CAAC,GAAGnG,MAAM,CAACkJ,UAAX,EAAuBhD,cAAvB,IAAyCA,cAAc,CAACqC,YAAD,CAAvD,GAAwErC,cAA/E;;UAEF,KAAK,EAAL;YACED,OAAO,GAAG4C,QAAQ,CAACE,IAAnB;YACAR,YAAY,CAACY,cAAb,CAA4B,SAA5B,EAAuClD,OAAvC;;UAEF,KAAK,EAAL;YACE4C,QAAQ,CAACC,IAAT,GAAgB,EAAhB;YACAD,QAAQ,CAAC1C,IAAT,GAAgB,EAAhB;YACA,OAAOA,IAAI,CAACoC,YAAD,CAAX;;UAEF,KAAK,EAAL;YACEG,aAAa,GAAGG,QAAQ,CAACE,IAAzB;;YAEA,IAAI,EAAE,CAACL,aAAD,IAAkB,CAACW,KAAK,CAACC,OAAN,CAAcZ,aAAa,CAACa,IAA5B,CAArB,CAAJ,EAA6D;cAC3DV,QAAQ,CAAC1C,IAAT,GAAgB,EAAhB;cACA;YACD;;YAED,MAAM,IAAIrG,wBAAJ,CAA6B,oEAA7B,CAAN;;UAEF,KAAK,EAAL;YACE4I,aAAa,CAACa,IAAd,CAAmBlC,OAAnB,CAA2B,UAAUmC,OAAV,EAAmBC,KAAnB,EAA0B;cACnD,IAAI,CAACD,OAAL,EAAc;cACd,IAAIE,OAAO,GAAG1C,WAAW,CAACyC,KAAD,CAAzB;;cAEA,IAAIC,OAAJ,EAAa;gBACX,IAAIC,KAAK,GAAGC,oBAAoB,CAAClB,aAAD,EAAgBc,OAAhB,CAAhC;;gBAEAE,OAAO,CAACxC,UAAR,CAAmByC,KAAnB;cACD;YACF,CATD;YAUA,OAAOd,QAAQ,CAACG,MAAT,CAAgB,QAAhB,EAA0BN,aAA1B,CAAP;;UAEF,KAAK,EAAL;YACEG,QAAQ,CAACC,IAAT,GAAgB,EAAhB;YACAD,QAAQ,CAACgB,EAAT,GAAchB,QAAQ,CAAC,OAAD,CAAR,CAAkB,EAAlB,CAAd;YACA7B,WAAW,CAACK,OAAZ,CAAoB,UAAUqC,OAAV,EAAmB;cACrC,OAAOA,OAAO,CAACnC,WAAR,CAAoBsB,QAAQ,CAACgB,EAA7B,CAAP;YACD,CAFD;;UAIF,KAAK,EAAL;YACE,OAAOhB,QAAQ,CAACG,MAAT,CAAgB,QAAhB,EAA0B/G,OAAO,CAACR,OAAR,EAA1B,CAAP;;UAEF,KAAK,EAAL;UACA,KAAK,KAAL;YACE,OAAOoH,QAAQ,CAACiB,IAAT,EAAP;QA5FJ;MA8FD;IACF,CAjGM,EAiGJzB,OAjGI,EAiGK,IAjGL,EAiGW,CAAC,CAAC,EAAD,EAAK,EAAL,CAAD,CAjGX,CAAP;EAkGD,CArG+C,CAAf,CAAjC;EAsGA,OAAOF,aAAa,CAAC3F,KAAd,CAAoB,IAApB,EAA0BD,SAA1B,CAAP;AACD;;AAED,SAASwF,gBAAT,CAA0Bf,WAA1B,EAAuCjF,KAAvC,EAA8C;EAC5CiF,WAAW,CAACK,OAAZ,CAAoB,UAAUqC,OAAV,EAAmB;IACrC,OAAOA,OAAO,CAACnC,WAAR,CAAoBxF,KAApB,CAAP;EACD,CAFD;AAGD,C,CAAC;;;AAGF,SAAS+F,mBAAT,CAA6Bd,WAA7B,EAA0C;EACxCA,WAAW,CAACK,OAAZ,CAAoB,UAAUqC,OAAV,EAAmBD,KAAnB,EAA0B;IAC5C,IAAI,CAACC,OAAO,CAAC1H,IAAb,EAAmB;MACjB0H,OAAO,CAACnC,WAAR,CAAoB,IAAIzH,wBAAJ,CAA6B,wDAAwDiK,MAAxD,CAA+DN,KAA/D,EAAsE,KAAtE,IAA+E,sCAAsCM,MAAtC,CAA6C/C,WAAW,CAAC/F,MAAzD,EAAiE,WAAjE,CAA5G,CAApB;IACD;EACF,CAJD;AAKD;;AAED,SAAS2I,oBAAT,CAA8BlB,aAA9B,EAA6Ca,IAA7C,EAAmD;EACjD;EACA,IAAIS,IAAI,GAAGT,IAAI,CAACC,OAAL,IAAgBD,IAA3B;EACA,IAAIpC,GAAG,GAAGuB,aAAa,CAACuB,KAAd,EAAV;EACA9C,GAAG,CAAC+C,eAAJ,CAAoBF,IAApB;EACA,OAAO7C,GAAP;AACD"},"metadata":{},"sourceType":"script"}