{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/anubhavgupta/Documents/react_learning/graphql-react/relay-store-learning/node_modules/@babel/runtime/regenerator/index.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = cacheMiddleware;\n\nvar _relayRuntime = require(\"relay-runtime\");\n\nvar _utils = require(\"../utils\");\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction cacheMiddleware(opts) {\n  var _ref = opts || {},\n      size = _ref.size,\n      ttl = _ref.ttl,\n      onInit = _ref.onInit,\n      allowMutations = _ref.allowMutations,\n      allowFormData = _ref.allowFormData,\n      clearOnMutation = _ref.clearOnMutation,\n      cacheErrors = _ref.cacheErrors,\n      updateTTLOnGet = _ref.updateTTLOnGet;\n\n  var cache = new _relayRuntime.QueryResponseCache({\n    size: size || 100,\n    // 100 requests\n    ttl: ttl || 15 * 60 * 1000 // 15 minutes\n\n  });\n\n  if ((0, _utils.isFunction)(onInit)) {\n    onInit(cache);\n  }\n\n  return function (next) {\n    return /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(req) {\n        var queryId, variables, res, _queryId, _variables, cachedRes, _res;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.isMutation()) {\n                  _context.next = 4;\n                  break;\n                }\n\n                if (clearOnMutation) {\n                  cache.clear();\n                }\n\n                if (allowMutations) {\n                  _context.next = 4;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", next(req));\n\n              case 4:\n                if (!(req.isFormData() && !allowFormData)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", next(req));\n\n              case 6:\n                if (!(req.cacheConfig && req.cacheConfig.force)) {\n                  _context.next = 14;\n                  break;\n                }\n\n                queryId = req.getID();\n                variables = req.getVariables();\n                _context.next = 11;\n                return next(req);\n\n              case 11:\n                res = _context.sent;\n\n                if (!res.errors || res.errors && cacheErrors) {\n                  cache.set(queryId, variables, res);\n                }\n\n                return _context.abrupt(\"return\", res);\n\n              case 14:\n                _context.prev = 14;\n                _queryId = req.getID();\n                _variables = req.getVariables();\n                cachedRes = cache.get(_queryId, _variables);\n\n                if (!cachedRes) {\n                  _context.next = 21;\n                  break;\n                }\n\n                if (updateTTLOnGet) {\n                  cache.set(_queryId, _variables, cachedRes);\n                }\n\n                return _context.abrupt(\"return\", cachedRes);\n\n              case 21:\n                _context.next = 23;\n                return next(req);\n\n              case 23:\n                _res = _context.sent;\n\n                if (!_res.errors || _res.errors && cacheErrors) {\n                  cache.set(_queryId, _variables, _res);\n                }\n\n                return _context.abrupt(\"return\", _res);\n\n              case 28:\n                _context.prev = 28;\n                _context.t0 = _context[\"catch\"](14); // if error, just log it to console\n\n                console.log(_context.t0);\n              // eslint-disable-line\n\n              case 31:\n                return _context.abrupt(\"return\", next(req));\n\n              case 32:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[14, 28]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  };\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","cacheMiddleware","_relayRuntime","require","_utils","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","opts","_ref","size","ttl","onInit","allowMutations","allowFormData","clearOnMutation","cacheErrors","updateTTLOnGet","cache","QueryResponseCache","isFunction","next","_ref2","mark","_callee","req","queryId","variables","res","_queryId","_variables","cachedRes","_res","wrap","_callee$","_context","prev","isMutation","clear","abrupt","isFormData","cacheConfig","force","getID","getVariables","sent","errors","set","get","t0","console","log","stop","_x"],"sources":["/Users/anubhavgupta/Documents/react_learning/graphql-react/relay-store-learning/node_modules/react-relay-network-modern/lib/middlewares/cache.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = cacheMiddleware;\n\nvar _relayRuntime = require(\"relay-runtime\");\n\nvar _utils = require(\"../utils\");\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction cacheMiddleware(opts) {\n  var _ref = opts || {},\n      size = _ref.size,\n      ttl = _ref.ttl,\n      onInit = _ref.onInit,\n      allowMutations = _ref.allowMutations,\n      allowFormData = _ref.allowFormData,\n      clearOnMutation = _ref.clearOnMutation,\n      cacheErrors = _ref.cacheErrors,\n      updateTTLOnGet = _ref.updateTTLOnGet;\n\n  var cache = new _relayRuntime.QueryResponseCache({\n    size: size || 100,\n    // 100 requests\n    ttl: ttl || 15 * 60 * 1000 // 15 minutes\n\n  });\n\n  if ((0, _utils.isFunction)(onInit)) {\n    onInit(cache);\n  }\n\n  return function (next) {\n    return /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(req) {\n        var queryId, variables, res, _queryId, _variables, cachedRes, _res;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.isMutation()) {\n                  _context.next = 4;\n                  break;\n                }\n\n                if (clearOnMutation) {\n                  cache.clear();\n                }\n\n                if (allowMutations) {\n                  _context.next = 4;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", next(req));\n\n              case 4:\n                if (!(req.isFormData() && !allowFormData)) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", next(req));\n\n              case 6:\n                if (!(req.cacheConfig && req.cacheConfig.force)) {\n                  _context.next = 14;\n                  break;\n                }\n\n                queryId = req.getID();\n                variables = req.getVariables();\n                _context.next = 11;\n                return next(req);\n\n              case 11:\n                res = _context.sent;\n\n                if (!res.errors || res.errors && cacheErrors) {\n                  cache.set(queryId, variables, res);\n                }\n\n                return _context.abrupt(\"return\", res);\n\n              case 14:\n                _context.prev = 14;\n                _queryId = req.getID();\n                _variables = req.getVariables();\n                cachedRes = cache.get(_queryId, _variables);\n\n                if (!cachedRes) {\n                  _context.next = 21;\n                  break;\n                }\n\n                if (updateTTLOnGet) {\n                  cache.set(_queryId, _variables, cachedRes);\n                }\n\n                return _context.abrupt(\"return\", cachedRes);\n\n              case 21:\n                _context.next = 23;\n                return next(req);\n\n              case 23:\n                _res = _context.sent;\n\n                if (!_res.errors || _res.errors && cacheErrors) {\n                  cache.set(_queryId, _variables, _res);\n                }\n\n                return _context.abrupt(\"return\", _res);\n\n              case 28:\n                _context.prev = 28;\n                _context.t0 = _context[\"catch\"](14);\n                // if error, just log it to console\n                console.log(_context.t0); // eslint-disable-line\n\n              case 31:\n                return _context.abrupt(\"return\", next(req));\n\n              case 32:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[14, 28]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"script"}